# Ralph Wiggum Prompt - LexRAG Fase 1

Implemente o sistema LexRAG seguindo o PRD em `prd-rag-juridico-local.md` e a documentação em `CLAUDE.md`.

## FASE 1: Setup Básico

### Tarefas Específicas:

#### 1. **config.py** (src/config.py)
- Criar constantes do projeto
- Configurar paths (data dir, chroma dir)
- Configurar modelos (embedding model, OCR engine)
- Usar dataclasses para configurações
- Type hints obrigatórios
- Docstrings Google style

#### 2. **loader.py** (src/indexer/loader.py)
- Implementar classe `DocumentLoader`
- Método `load_pdf(file_path: str) -> str` usando pymupdf
- Método `load_docx(file_path: str) -> str` usando python-docx + mammoth
- Método `load_text(file_path: str) -> str` para TXT/MD
- Detecção automática de necessidade de OCR (texto < 50 chars)
- Retornar dict com: {text: str, metadata: dict}
- Async methods quando aplicável
- Tratamento de erros robusto

#### 3. **ocr.py** (src/indexer/ocr.py)
- Implementar classe `OCREngine`
- Suportar EasyOCR (padrão) e Tesseract (opcional)
- Método `apply_ocr(image_bytes: bytes) -> str`
- Detecção de idioma (português)
- Configuração de GPU (opcional)
- Cache de modelo para performance
- Tratamento de erros com fallback

#### 4. **chunker.py** (src/indexer/chunker.py)
- Implementar classe `LegalDocumentChunker`
- Usar langchain RecursiveCharacterTextSplitter
- Separadores para documentos jurídicos:
  ```python
  separators = [
      r"\nArt\. \d+",
      r"\n§ \d+",
      r"\n[IVX]+[ –-]",
      r"\n[IVX]+\. ",
      r"\nDOS? ",
      r"\nDA ",
      "\n\n",
      "\n",
      ". ",
      " ",
  ]
  ```
- chunk_size: 1000, chunk_overlap: 200
- Preservar metadados em cada chunk
- Retornar lista de chunks com: {content, metadata, chunk_index}

#### 5. **embedder.py** (src/indexer/embedder.py)
- Implementar classe `EmbeddingGenerator`
- Suportar sentence-transformers (all-MiniLM-L6-v2)
- Suportar Ollama (opcional)
- Método `generate_embeddings(texts: List[str]) -> List[List[float]]`
- Embeddings de 384 dimensões
- Batch processing para performance
- Cache de modelo

#### 6. **vector_store.py** (src/retriever/vector_store.py)
- Implementar classe `VectorStore`
- Usar ChromaDB com persistência SQLite
- Método `add_documents(chunks: List[dict]) -> None`
- Método `search(query: str, top_k: int = 5) -> List[dict]`
- Método `delete_document(doc_id: str) -> None`
- Retornar resultados com: {content, score, metadata}
- Configurar collection name

### Critérios de Conclusão:

✅ pyproject.toml instalado com `pip install -e .`
✅ Todos os módulos implementados com type hints
✅ Docstrings Google style em todas as funções/classes
✅ Código segue padrões PEP 8 (verificar com ruff)
✅ Modules podem ser importados:
   ```python
   from lexrag.config import settings
   from lexrag.indexer import DocumentLoader, OCREngine, LegalDocumentChunker, EmbeddingGenerator
   from lexrag.retiever import VectorStore
   ```

### Metodologia TDD:

1. **Escreva testes primeiro** para cada módulo
2. **Implemente funcionalidade mínima** para passar nos testes
3. **Refatore** quando necessário
4. **Commits frequentes** com mensagens claras
5. **Verifique type hints** com mypy (se possível)
6. **Rode ruff** para linting

### Ordem Sugerida:

1. config.py + test_config.py
2. loader.py + test_loader.py
3. ocr.py + test_ocr.py
4. chunker.py + test_chunker.py
5. embedder.py + test_embedder.py
6. vector_store.py + test_vector_store.py

### Output de Conclusão:

Quando TODAS as tarefas acima estiverem completas e testadas, output:

<promise>FASE1_COMPLETE</promise>
